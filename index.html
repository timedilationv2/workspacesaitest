<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sophie AI - Personal Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <style>
        :root {
            --bg-main: #F7F8FC;
            --bg-secondary: #FFFFFF;
            --header-bg: linear-gradient(100deg, #E6E9F7 0%, #F4E8EE 100%);
            --primary-blue: #AEC6F4;
            --primary-pink: #F8C8DC;
            --text-primary: #1F2937;
            --text-secondary: #6B7280;
            --border-color: #E5E7EB;
            --shadow-color: rgba(99, 102, 241, 0.1);
            --active-shadow: 0 10px 20px -5px rgba(115, 115, 115, 0.2);
        }
        
        body.dark {
            --bg-main: #111827;
            --bg-secondary: #1F2937;
            --header-bg: linear-gradient(100deg, #1F2937 0%, #374151 100%);
            --text-primary: #F9FAFB;
            --text-secondary: #9CA3AF;
            --border-color: #374151;
            --shadow-color: rgba(0, 0, 0, 0.2);
        }
        body.dark .nav-button { background-color: rgba(55, 65, 81, 0.6); border-color: rgba(55, 65, 81, 0.8); }
        body.dark .nav-button.active { background-color: var(--bg-secondary); border-color: var(--primary-blue); }
        body.dark textarea, body.dark input[type=text], body.dark input[type=url] { background-color: #374151; border-color: #4B5563; color: var(--text-primary); }
        body.dark .btn-secondary { background: #374151; color: #F9FAFB; }
        body.dark .btn-secondary:hover { background: #4B5563; }
        body.dark .quick-action-btn { border-color: #4B5563; }
        body.dark .quick-action-btn:hover { background-color: #374151; }
        body.dark .inbox-header { color: var(--text-secondary); }
        body.dark .discovery-item { background-color: #374151; border-color: #4B5563; }
        body.dark .discovery-item:hover { background-color: #4B5563; }
        body.dark #global-search { background-color: rgba(255,255,255,0.1); }
        body.dark .calendar-day.other-month { color: #4B5563; }

        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-primary);
            overflow-y: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        .dashboard-layout { display: flex; flex-direction: column; height: 100vh; }
        .main-header {
            background: var(--header-bg);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-container { display: flex; justify-content: center; align-items: center; gap: 1rem; }
        .nav-button {
            background-color: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.8);
            border-radius: 1rem;
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .nav-button:hover { transform: translateY(-3px); box-shadow: var(--active-shadow); }
        .nav-button.active {
            background-color: var(--bg-secondary);
            transform: translateY(-3px);
            box-shadow: var(--active-shadow);
            border-color: var(--primary-blue);
        }
        .nav-button .icon { font-size: 1.5rem; }
        .nav-button .label { font-size: 1rem; font-weight: 600; color: var(--text-primary); }
        .header-utils { display: flex; align-items: center; gap: 1rem; }
        #global-search { border-radius: 9999px; padding-left: 2.5rem; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%239ca3af' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: 0.75rem center; }
        
        .main-content-area { flex-grow: 1; overflow-y: auto; padding: 2.5rem; }
        .content-section { max-width: 1200px; margin: 0 auto; }
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; }

        .panel {
            background-color: var(--bg-secondary);
            border-radius: 1.25rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px var(--shadow-color);
            overflow: hidden;
        }
        .panel-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--border-color); }
        .panel-title { font-size: 1.125rem; font-weight: 600; color: var(--text-primary); }
        .panel-body { padding: 1.5rem; }
        
        textarea, input[type=text], input[type=url] {
            background-color: #F9FAFB;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            width: 100%;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        textarea:focus, input:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 0 3px rgba(174, 198, 244, 0.4); }
        .btn { padding: 0.6rem 1.25rem; border-radius: 0.5rem; font-weight: 500; cursor: pointer; transition: all 0.2s; border: 1px solid transparent; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .btn-primary { background-color: var(--text-primary); color: var(--bg-secondary); }
        .btn-primary:hover { background-color: #374151; }
        body.dark .btn-primary:hover { background-color: #4b5563; }
        .btn-secondary { background-color: #E5E7EB; color: #374151; }
        .btn-secondary:hover { background-color: #D1D5DB; }
        .list-item { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 0.25rem; border-bottom: 1px solid var(--border-color); }
        .list-item:last-child { border-bottom: none; }
        .delete-btn { background: none; border: none; cursor: pointer; color: var(--text-secondary); opacity: 0.5; transition: opacity .2s; }
        .list-item:hover .delete-btn { opacity: 1; }

        /* Workspace Section Styles */
        .quick-actions-bar { display: flex; gap: 0.75rem; margin-bottom: 1.5rem; }
        .quick-action-btn { background-color: transparent; border: 1px solid var(--border-color); color: var(--text-secondary); font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.5rem; transition: all .2s; }
        .quick-action-btn:hover { background-color: var(--bg-main); color: var(--text-primary); }
        .inbox-header { display: grid; grid-template-columns: 40px 3fr 1fr 1fr 1fr 40px; gap: 1rem; padding: 0 1rem; margin-bottom: 0.5rem; font-size: 0.75rem; font-weight: 600; color: #9CA3AF; text-transform: uppercase; }
        .inbox-item { display: grid; grid-template-columns: 40px 3fr 1fr 1fr 1fr 40px; gap: 1rem; align-items: center; padding: 0.75rem 1rem; border-radius: 0.5rem; transition: background-color .2s; }
        .inbox-item:hover { background-color: var(--bg-main); }
        .inbox-item .tag { font-size: 0.75rem; font-weight: 500; padding: 0.125rem 0.5rem; border-radius: 9999px; }
        .tag-p-low { background-color: #DBEAFE; color: #1E40AF; }
        .tag-p-medium { background-color: #FEF3C7; color: #92400E; }
        .tag-p-high { background-color: #FEE2E2; color: #991B1B; }
        .tag-s-todo { background-color: #F3F4F6; color: #4B5563; }
        .tag-s-inprogress { background-color: #D1FAE5; color: #065F46; }
        .tag-s-done { background-color: #E0E7FF; color: #3730A3; }

        /* Modal Styles */
        .modal-overlay { position: fixed; inset: 0; background-color: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 50; opacity: 0; visibility: hidden; transition: opacity .3s, visibility .3s; }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content { background-color: var(--bg-secondary); padding: 2rem; border-radius: 1rem; width: 90%; max-width: 600px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        
        /* Other Widgets */
        #calendar-widget { text-align: center; }
        #calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        #calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; }
        .calendar-day, .calendar-header-day { padding: 0.75rem; border-radius: 0.5rem; }
        .calendar-header-day { font-weight: 600; color: var(--text-secondary); }
        .calendar-day.current-day { background-color: var(--primary-pink); color: var(--text-primary); font-weight: bold; }
        .calendar-day.other-month { color: #ccc; }
        .discovery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); gap: 0.75rem; margin-bottom: 1.5rem; }
        .discovery-item { background-color: #F9FAFB; border: 1px solid var(--border-color); border-radius: 0.75rem; padding: 0.75rem; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0.25rem; text-decoration: none; transition: all .2s; }
        .discovery-item:hover { transform: translateY(-2px); background-color: #F3F4F6; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .discovery-item .icon { font-size: 1.5rem; }
        .discovery-item .label { font-size: 0.75rem; font-weight: 500; color: var(--text-secondary); }

        .toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: var(--text-primary); color: var(--bg-secondary); padding: .75rem 1.5rem; border-radius: 9999px; font-weight: 500; opacity: 0; visibility: hidden; transition: all .4s ease-in-out; z-index: 100; box-shadow: 0 5px 15px rgba(0,0,0,.1); }
        .toast.show { opacity: 1; visibility: visible; bottom: 1.5rem; }
        .loader { width: 20px; height: 20px; border: 3px solid #FFF; border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite; }
        @keyframes rotation { 100% { transform: rotate(360deg); } }
        .theme-switch { display: inline-block; height: 24px; position: relative; width: 44px; }
        .theme-switch input { display:none; }
        .slider { background-color: #ccc; position: absolute; cursor: pointer; inset: 0; transition: .4s; border-radius: 24px; }
        .slider:before { background-color: #fff; content: ""; height: 18px; width: 18px; position: absolute; left: 3px; bottom: 3px; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-blue); }
        input:checked + .slider:before { transform: translateX(20px); }
    </style>
</head>
<body>

    <div class="dashboard-layout">
        <header class="main-header">
            <nav id="main-nav" class="nav-container">
                <button class="nav-button active" data-section="workspace"><span class="icon">üóÇÔ∏è</span><span class="label">Workspace</span></button>
                <button class="nav-button" data-section="wellness"><span class="icon">üåø</span><span class="label">Wellness</span></button>
                <button class="nav-button" data-section="calendar"><span class="icon">üóìÔ∏è</span><span class="label">Calendar</span></button>
                <button class="nav-button" data-section="notes"><span class="icon">üìù</span><span class="label">Notes & Links</span></button>
            </nav>
            <div class="header-utils">
                <input type="text" id="global-search" placeholder="Search..." class="w-64">
                <label class="theme-switch">
                    <input type="checkbox" id="theme-toggle">
                    <span class="slider"></span>
                </label>
            </div>
        </header>

        <main class="main-content-area">
            <!-- Workspace Section -->
            <section id="workspace-section" class="content-section">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold">Workspace</h1>
                    <p class="text-gray-500 mt-1">Organize your tasks, projects, and goals.</p>
                </div>
                <div class="quick-actions-bar">
                    <button class="quick-action-btn" data-action="new-task">+ New Task</button>
                    <button class="quick-action-btn" data-action="new-note">+ New Note</button>
                    <button class="quick-action-btn" data-action="new-project">+ New Project</button>
                </div>
                <div class="panel">
                    <div class="panel-header"><h2 class="panel-title">üì• Inbox</h2></div>
                    <div class="panel-body">
                        <form id="add-inbox-form" class="flex gap-2 mb-4">
                            <input type="text" id="inbox-input" placeholder="Add a new task to your inbox..." required>
                            <button type="submit" class="btn btn-secondary !px-4">Add</button>
                        </form>
                        <div class="inbox-header">
                            <span></span><span>Task</span><span>Project</span><span>Priority</span><span>Status</span><span></span>
                        </div>
                        <div id="inbox-list"></div>
                    </div>
                </div>
            </section>

            <!-- Other sections remain the same -->
            <section id="wellness-section" class="content-section hidden">
                 <div class="mb-8"><h1 class="text-3xl font-bold">Daily Wellness</h1><p class="text-gray-500 mt-1">Track your habits and feel your best.</p></div>
                <div class="grid-layout">
                    <div class="panel"><div class="panel-header"><h3 class="panel-title">üå± Habit Tracker</h3></div><div class="panel-body" id="habit-tracker"></div></div>
                    <div class="panel"><div class="panel-header"><h3 class="panel-title">üíä Daily Supplements</h3></div><div class="panel-body"><form id="add-supplement-form" class="flex gap-2 mb-3"><input type="text" id="supplement-input" placeholder="e.g., Vitamin D" required><button type="submit" class="btn btn-secondary !px-4">Add</button></form><div id="supplement-list"></div></div></div>
                </div>
            </section>
            <section id="calendar-section" class="content-section hidden">
                 <div class="mb-8"><h1 class="text-3xl font-bold">Calendar</h1><p class="text-gray-500 mt-1">A simple overview of your month.</p></div>
                <div class="panel"><div class="panel-body" id="calendar-widget"></div></div>
            </section>
            <section id="notes-section" class="content-section hidden">
                 <div class="mb-8"><h1 class="text-3xl font-bold">Notes & Links</h1><p class="text-gray-500 mt-1">Your digital scrapbook for thoughts and resources.</p></div>
                <div class="grid-layout" style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
                    <div class="panel"><div class="panel-header"><h3 class="panel-title">üìã Quick Notes</h3></div><div class="panel-body"><form id="add-clipboard-form" class="flex flex-col gap-3 mb-3"><textarea id="clipboard-input" placeholder="Save a quick note..." required rows="4"></textarea><button type="submit" class="btn btn-secondary self-end">Save Note</button></form><div id="clipboard-list"></div></div></div>
                    <div class="panel"><div class="panel-header"><h3 class="panel-title">üîó Saved Links</h3></div><div class="panel-body"><form id="add-link-form" class="flex flex-col gap-2 mb-3"><input type="text" id="link-title-input" placeholder="Title" required><input type="url" id="link-url-input" placeholder="https://example.com" required><button type="submit" class="btn btn-secondary self-end">Add Link</button></form><div id="links-list"></div></div></div>
                    <div class="panel"><div class="panel-header"><h3 class="panel-title">üöÄ Discovery Hub</h3></div><div class="panel-body" id="discovery-hub"></div></div>
                </div>
            </section>
        </main>
    </div>
    
    <!-- AI Editor Modal -->
    <div id="ai-editor-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">AI Editor</h2>
                <button id="close-modal-btn" class="text-2xl">&times;</button>
            </div>
            <textarea id="editor-input" class="min-h-[200px] w-full" placeholder="Start writing..."></textarea>
            <h3 class="font-semibold mt-4 mb-2">Need some inspiration?</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="prompt-cards"></div>
            <div class="text-right mt-4">
                <button id="ask-sophie-btn" class="btn btn-primary"><span id="btn-text">Ask Sophie</span><span id="loader" class="hidden loader"></span></button>
            </div>
        </div>
    </div>

    <div class="fixed bottom-6 right-6 flex flex-col gap-2 z-40">
        <button class="btn btn-secondary shadow-lg" id="export-btn">Export JSON ‚¨áÔ∏é</button>
        <label class="btn btn-secondary shadow-lg cursor-pointer">Import JSON ‚¨ÜÔ∏é <input type="file" id="import-file" accept="application/json" class="hidden"></label>
    </div>

    <div id="toast-notification" class="toast"></div>

    <script>
        const YOUR_API_KEY = "";
        const LS_KEY = 'sophieAiDashboard_v3';
        let state = {
            links: [], clipboard: [], inbox: [], habits: {}, supplements: { list: [] }, editorContent: "", theme: 'light'
        };
        let calendarDate = new Date();

        const prompts = [
            { title: "Draft a professional email", desc: "to follow up on a job application." },
            { title: "Brainstorm side hustle ideas", desc: "related to content creation or design." },
            { title: "Suggest healthy lunch ideas", desc: "for a busy work week." },
            { title: "Write an Instagram caption", desc: "for a photo of a weekend trip." },
            { title: "Create a 3-day workout plan", desc: "focusing on strength and cardio." },
            { title: "Recommend a new podcast", desc: "in the true crime or self-improvement genre." }
        ];
        const dailyHabits = ["Hydrate (8 glasses)", "Move for 30 mins", "Read 10 pages", "Mindful moment"];
        const discoveryLinks = [
            { title: "Pinterest", url: "https://pinterest.com", icon: "üé®" },
            { title: "Notion", url: "https://notion.so", icon: "üìñ" },
            { title: "Canva", url: "https://canva.com", icon: "‚ú®" },
            { title: "YouTube", url: "https://youtube.com", icon: "‚ñ∂Ô∏è" },
            { title: "The Everygirl", url: "https://theeverygirl.com/", icon: "üì∞" },
            { title: "Trello", url: "https://trello.com", icon: "üìã" }
        ];
        
        const $ = (sel) => document.querySelector(sel);
        const $$ = (sel) => [...document.querySelectorAll(sel)];

        let toastTimer;
        function showToast(msg, duration = 3000) {
            const t = $('#toast-notification');
            clearTimeout(toastTimer);
            t.textContent = msg;
            t.classList.add('show');
            toastTimer = setTimeout(() => t.classList.remove('show'), duration);
        }

        function save() {
            state.editorContent = $('#editor-input').value;
            localStorage.setItem(LS_KEY, JSON.stringify(state));
        }

        function load() {
            const raw = localStorage.getItem(LS_KEY);
            if (raw) {
                const loadedState = JSON.parse(raw);
                state = {...state, ...loadedState};
            }
            $('#editor-input').value = state.editorContent || '';
            
            const today = new Date().toISOString().slice(0, 10);
            if (!state.habits || state.habits.date !== today) state.habits = { date: today, completed: [] };
            if (!state.supplements || state.supplements.date !== today) {
                const existingList = state.supplements?.list || [];
                state.supplements = { date: today, list: existingList.map(s => ({ name: s.name, taken: false })) };
            }
            if (!state.inbox) state.inbox = [];
            
            setTheme(state.theme || 'light');
            renderAll();
        }

        function renderAll() {
            renderPrompts();
            renderInbox();
            renderHabits();
            renderSupplements();
            renderCalendar();
            renderGenericList('clipboard', '#clipboard-list');
            renderLinks();
            renderDiscoveryHub();
        }

        function renderInbox() {
            $('#inbox-list').innerHTML = state.inbox.map((task, i) => `
                <div class="inbox-item">
                    <input type="checkbox" data-act="toggle-inbox" data-index="${i}" ${task.done ? 'checked' : ''} class="form-checkbox h-4 w-4 rounded text-pink-400 focus:ring-pink-300">
                    <span class="${task.done ? 'line-through text-gray-400' : ''}">${task.text}</span>
                    <span class="text-sm text-gray-500">${task.project}</span>
                    <span class="tag tag-p-${task.priority.toLowerCase()}">${task.priority}</span>
                    <span class="tag tag-s-${task.status.toLowerCase().replace(' ','')}">${task.status}</span>
                    <button data-act="del" data-type="inbox" data-index="${i}" class="delete-btn">‚ùå</button>
                </div>
            `).join('') || `<p class="text-sm text-center text-gray-400 py-4">Inbox zero! Well done. ‚ú®</p>`;
        }
        
        function renderLinks() { $('#links-list').innerHTML = state.links.map((l, i) => `<div class="list-item"><a href="${l.url}" target="_blank" rel="noopener" class="text-blue-600 hover:underline text-sm font-medium break-all">${l.title}</a><button data-act="del" data-type="links" data-index="${i}" class="delete-btn">‚ùå</button></div>`).join('') || `<p class="text-xs text-center text-gray-400 py-2">No links saved.</p>`; }
        function renderHabits() { $('#habit-tracker').innerHTML = dailyHabits.map((habit) => `<div class="list-item"><label class="flex items-center gap-3 text-sm cursor-pointer w-full"><input type="checkbox" data-act="toggle-habit" data-habit="${habit}" ${state.habits.completed.includes(habit) ? 'checked' : ''} class="form-checkbox h-4 w-4 rounded text-blue-500 focus:ring-blue-400"><span>${habit}</span></label></div>`).join(''); }
        function renderSupplements() { $('#supplement-list').innerHTML = state.supplements.list.map((s, i) => `<div class="list-item"><label class="flex items-center gap-3 text-sm cursor-pointer w-full"><input type="checkbox" data-act="toggle-supplement" data-index="${i}" ${s.taken ? 'checked' : ''} class="form-checkbox h-4 w-4 rounded text-pink-400 focus:ring-pink-300"><span>${s.name}</span></label><button data-act="del" data-type="supplements" data-index="${i}" class="delete-btn">‚ùå</button></div>`).join('') || `<p class="text-xs text-center text-gray-400 py-2">Add supplements you take daily.</p>`; }
        function renderGenericList(type, containerSel) { $(containerSel).innerHTML = state[type].map((it, i) => `<div class="list-item"><p class="text-sm flex-grow">${it.content.replace(/</g, "&lt;")}</p><button data-act="del" data-type="${type}" data-index="${i}" class="delete-btn">‚ùå</button></div>`).join('') || `<p class="text-xs text-center text-gray-400 py-2">No notes saved.</p>`; }
        function renderPrompts() { $$('#prompt-cards').forEach(el => { el.innerHTML = prompts.map(p => `<button class="prompt-card bg-gray-50 hover:bg-gray-100 border border-gray-200 rounded-lg p-4 text-left transition" data-prompt-title="${p.title}" data-prompt-desc="${p.desc}"><div class="font-semibold text-sm">${p.title}</div><div class="text-xs text-gray-500 mt-1">${p.desc}</div></button>`).join(''); }); }
        function renderDiscoveryHub() { $('#discovery-hub').innerHTML = `<div class="discovery-grid">${discoveryLinks.map(link => `<a href="${link.url}" target="_blank" rel="noopener noreferrer" class="discovery-item"><span class="icon">${link.icon}</span><span class="label">${link.title}</span></a>`).join('')}</div>`; }
        function renderCalendar() {
            const calWidget = $('#calendar-widget'); if (!calWidget) return;
            const month = calendarDate.getMonth(), year = calendarDate.getFullYear();
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            let html = `<div id="calendar-header"><button id="prev-month" class="btn btn-secondary !px-3">‚Äπ</button><h3 class="text-lg font-bold">${monthNames[month]} ${year}</h3><button id="next-month" class="btn btn-secondary !px-3">‚Ä∫</button></div><div id="calendar-grid">${['S', 'M', 'T', 'W', 'T', 'F', 'S'].map(d => `<div class="calendar-header-day">${d}</div>`).join('')}`;
            for (let i = 0; i < firstDay; i++) html += `<div></div>`;
            const today = new Date();
            for (let i = 1; i <= daysInMonth; i++) {
                const isToday = i === today.getDate() && month === today.getMonth() && year === today.getFullYear();
                html += `<div class="calendar-day ${isToday ? 'current-day' : ''}">${i}</div>`;
            }
            html += '</div>';
            calWidget.innerHTML = html;
        }

        function switchSection(sectionId) { $$('.content-section').forEach(s => s.classList.add('hidden')); $(`#${sectionId}-section`).classList.remove('hidden'); $$('.nav-button').forEach(b => b.classList.toggle('active', b.dataset.section === sectionId)); }
        function setTheme(theme) { state.theme = theme; document.body.classList.toggle('dark', theme === 'dark'); $('#theme-toggle').checked = (theme === 'dark'); save(); }
        function toggleModal(visible) { $('#ai-editor-modal').classList.toggle('visible', visible); }
        
        async function callSophieAPI() { /* Omitted for brevity - same as before */ }

        document.addEventListener('click', e => {
            const target = e.target;
            const navBtn = target.closest('.nav-button'); if (navBtn) { switchSection(navBtn.dataset.section); return; }
            const promptBtn = target.closest('[data-prompt-title]');
            if (promptBtn) { const { promptTitle, promptDesc } = promptBtn.dataset; $('#editor-input').value = `${promptTitle}\n"${promptDesc}"`; $('#editor-input').focus(); return; }
            
            const quickActionBtn = target.closest('.quick-action-btn');
            if(quickActionBtn) {
                const action = quickActionBtn.dataset.action;
                if(action === 'new-note') toggleModal(true);
                else if (action === 'new-task') $('#inbox-input').focus();
                else showToast('This feature is coming soon!');
                return;
            }

            if(target.id === 'close-modal-btn') { toggleModal(false); return; }

            const actionBtn = target.closest('[data-act]');
            if (actionBtn) {
                const { act, type, index } = actionBtn.dataset;
                if (act === 'del') {
                    if (type === 'supplements') state.supplements.list.splice(index, 1);
                    else state[type].splice(index, 1);
                    save(); renderAll();
                }
                return;
            }
            if (target.id === 'prev-month') { calendarDate.setMonth(calendarDate.getMonth() - 1); renderCalendar(); }
            if (target.id === 'next-month') { calendarDate.setMonth(calendarDate.getMonth() + 1); renderCalendar(); }
            if (target.id === 'export-btn') {
                const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
                const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'sophie-dashboard-export.json'; a.click(); URL.revokeObjectURL(a.href);
                showToast('Export successful!');
            }
        });
        
        document.body.addEventListener('change', e => {
            const input = e.target.closest('input[type="checkbox"]'); if (!input) return;
            const {act, habit, index} = input.dataset;
            if (act === 'toggle-habit') { if (input.checked) { if (!state.habits.completed.includes(habit)) state.habits.completed.push(habit); } else { state.habits.completed = state.habits.completed.filter(h => h !== habit); } }
            if (act === 'toggle-supplement') state.supplements.list[index].taken = input.checked;
            if (act === 'toggle-inbox') { state.inbox[index].done = input.checked; state.inbox[index].status = input.checked ? 'Done' : 'In Progress'; renderInbox(); }
            save();
        });

        $('#theme-toggle')?.addEventListener('change', e => setTheme(e.target.checked ? 'dark' : 'light'));
        $('#import-file').addEventListener('change', e => {
            const file = e.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = ev => { try { const data = JSON.parse(ev.target.result); state = { ...state, ...data }; save(); load(); showToast('Imported successfully!'); } catch (err) { showToast('Import failed: Invalid file.'); } };
            reader.readAsText(file); e.target.value = '';
        });
        $('#global-search').addEventListener('input', e => {
            const q = e.target.value.toLowerCase().trim();
            $$('.list-item, .inbox-item').forEach(item => { const text = item.textContent.toLowerCase(); item.style.display = text.includes(q) ? '' : 'grid'; });
        });

        function setupForm(formId, inputId, handlerFn) {
            const form = $(formId); if (!form) return;
            const input = $(inputId);
            form.addEventListener('submit', e => { e.preventDefault(); const value = input.value.trim(); if (!value) return; handlerFn(value); input.value = ''; });
        }

        document.addEventListener('DOMContentLoaded', () => {
            load();
            setupForm('#add-link-form', '#link-title-input', () => { const title = $('#link-title-input').value.trim(); const url = $('#link-url-input').value.trim(); if (title && url) { state.links.unshift({ title, url }); $('#link-url-input').value = ''; save(); renderLinks(); } });
            setupForm('#add-clipboard-form', '#clipboard-input', (value) => { state.clipboard.unshift({ content: value }); save(); renderGenericList('clipboard', '#clipboard-list'); });
            setupForm('#add-supplement-form', '#supplement-input', (value) => { state.supplements.list.push({ name: value, taken: false }); save(); renderSupplements(); });
            setupForm('#add-inbox-form', '#inbox-input', (value) => { state.inbox.unshift({ text: value, done: false, project: 'General', priority: 'Medium', status: 'To Do' }); save(); renderInbox(); });
            $('#ask-sophie-btn')?.addEventListener('click', callSophieAPI);
        });
    </script>
</body>
</html>

